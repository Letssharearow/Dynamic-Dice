package com.example.dynamicdiceprototype.services

import android.graphics.Bitmap
import android.graphics.BitmapFactory
import android.util.Log
import androidx.compose.ui.graphics.ImageBitmap
import androidx.compose.ui.graphics.asImageBitmap
import com.example.dynamicdiceprototype.data.ImageModel
import com.google.firebase.Firebase
import com.google.firebase.firestore.firestore
import java.io.ByteArrayOutputStream
import kotlin.io.encoding.Base64
import kotlin.io.encoding.ExperimentalEncodingApi
import kotlinx.coroutines.flow.flow
import kotlinx.coroutines.tasks.await

val TAG = "MyApp"
val COLLECTIONNAME = "images"

enum class ImageProperty {
  CONTENT_DESCRIPTION,
  IMAGE_BITMAP
}

class FirebaseDataStore {
  val db = Firebase.firestore
  val imagesFlow =
      flow<Map<String, ImageModel>> {
        val map = mutableMapOf<String, ImageModel>()
        val collectionRef = Firebase.firestore.collection(COLLECTIONNAME)
        collectionRef
            .get()
            .addOnSuccessListener { documents ->
              for (document in documents) {
                val documentId = document.id
                val documentData = document.data
                Log.d(TAG, "Firebase fetching data: $documentId => $documentData")
                val base64String =
                    documentData["${ImageProperty.IMAGE_BITMAP}"] as? String ?: continue
                val name =
                    documentData["${ImageProperty.CONTENT_DESCRIPTION}"] as? String ?: continue
                map[documentId] =
                    ImageModel(
                        imageBitmap = base64ToBitmap(base64String), contentDescription = name)
              }
              Log.d(TAG, "Firebase all data fetched (keys): ${map.keys}")
            }
            .addOnFailureListener { exception ->
              // Handle any errors here
              Log.e(TAG, "fetching Exception ${exception.message}")
            }
            .await()
        emit(map)
      }

  fun uploadBitmap(key: String, name: String, bitmap: Bitmap) {
    val saveImage = bitmapToBase64(bitmap) // TODO rename
    val asHashMap =
        hashMapOf(
            "${ImageProperty.IMAGE_BITMAP}" to saveImage,
            "${ImageProperty.CONTENT_DESCRIPTION}" to name) // TODO rename
    Log.d(TAG, "Firebase save this: $key => $asHashMap")
    db.collection(COLLECTIONNAME)
        .document(key)
        .set(asHashMap)
        .addOnSuccessListener { documentReference ->
          Log.d(TAG, "Firebase DocumentSnapshot added with ID: $documentReference")
        }
        .addOnFailureListener { e -> Log.w(TAG, "Firebase Error adding document", e) }
  }

  @OptIn(ExperimentalEncodingApi::class)
  fun base64ToBitmap(base64String: String): ImageBitmap {
    return try {
      val decodedBytes = Base64.decode(base64String)
      val bitmap = BitmapFactory.decodeByteArray(decodedBytes, 0, decodedBytes.size)
      bitmap.asImageBitmap()
    } catch (e: Exception) {
      e.printStackTrace()
      Log.e(TAG, e.message ?: "No message")
      val decodedBytes =
          Base64.decode(
              "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")
      val bitmap = BitmapFactory.decodeByteArray(decodedBytes, 0, decodedBytes.size)
      bitmap.asImageBitmap()
    }
  }

  @OptIn(ExperimentalEncodingApi::class)
  private fun bitmapToBase64(bitmap: Bitmap): String {
    val byteArrayOutputStream = ByteArrayOutputStream()
    bitmap.compress(Bitmap.CompressFormat.PNG, 100, byteArrayOutputStream)
    val byteArray = byteArrayOutputStream.toByteArray()
    return Base64.encode(byteArray)
  }
}
